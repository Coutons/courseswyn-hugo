{{ if eq hugo.Environment "production" }}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const key = '20f13189cd0c45a8bcacdb6a60b72caa';
    const currentUrl = window.location.href.split('?')[0]; // Remove query parameters
    const apiUrl = `https://www.bing.com/indexnow?url=${encodeURIComponent(currentUrl)}&key=${key}`;
    
    // Only submit if this is a content page, not homepage or archive
    if (window.location.pathname !== '/' && !window.location.pathname.startsWith('/page/')) {
        fetch(apiUrl, { 
            method: 'GET',
            keepalive: true
        })
        .then(response => {
            if (!response.ok) {
                console.warn('IndexNow submission failed for:', currentUrl);
            }
        })
        .catch(error => console.error('IndexNow error:', error));
    }
});
</script>
{{ end }}
