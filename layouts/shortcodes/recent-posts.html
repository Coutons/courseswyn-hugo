{{ $tag := .Get "tag" }}
{{ $pages := where .Site.RegularPages "Type" "posts" }}

{{ if $tag }}
  {{ $pages = where $pages "Params.tags" "intersect" (slice $tag) }}
{{ end }}

<div class="recent-posts">
  {{ range first 10 $pages }}
    <article class="post-preview">
      <h3><a href="{{ .RelPermalink }}">{{ .Title }}</a></h3>
      <div class="post-meta">
        <time datetime="{{ .Date.Format "2006-01-02" }}">
          {{ .Date.Format "January 2, 2006" }}
        </time>
        {{ with .Params.categories }}
          in
          {{ range . }}
            <a href="/categories/{{ . | urlize }}">{{ . }}</a>
          {{ end }}
        {{ end }}
      </div>
      <p>{{ .Summary }}</p>
      {{ if .Truncated }}
        <a href="{{ .RelPermalink }}" class="read-more">Read More â†’</a>
      {{ end }}
    </article>
  {{ end }}
</div>
