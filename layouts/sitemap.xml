{{- $p := . -}}
{{- $now := now.Format "2006-01-02T15:04:05-07:00" -}}
{{- $pages := .Data.Pages -}}
{{- $sitemap := .Site.Data.sitemap -}}

{{- printf "<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?>" | safeHTML }}
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9"
  xmlns:xhtml="http://www.w3.org/1999/xhtml">
  {{- range $pages -}}
    {{- if not .Params.noindex -}}
      {{- $permalink := .Permalink -}}
      {{- $lastmod := .Lastmod.Format "2006-01-02T15:04:05-07:00" -}}
      
      {{- /* Override specific URLs with current date */ -}}
      {{- if or (eq $permalink "https://courseswyn.com/categories/") (eq $permalink "https://courseswyn.com/") -}}
        {{- $lastmod = $now -}}
      {{- end -}}
      
      <url>
        <loc>{{ $permalink }}</loc>
        <lastmod>{{ $lastmod }}</lastmod>
        {{- if eq .Section "posts" }}
          <changefreq>weekly</changefreq>
          <priority>0.8</priority>
        {{- else if eq .Section "pages" }}
          <changefreq>monthly</changefreq>
          <priority>0.5</priority>
        {{- else }}
          <changefreq>weekly</changefreq>
          <priority>0.5</priority>
        {{- end }}
      </url>
    {{- end -}}
  {{- end }}
</urlset>
